apiVersion: v1
kind: Service
metadata:
  name: {{ include "axon-server.fullname" . }}-grpc
  labels:
    {{- include "axon-server.labels" . | nindent 4 }}
spec:
  type: {{ .Values.services.grpc.type }}
  ports:
    - name: grpc-port
      port: {{ .Values.services.grpc.port }}
      protocol: TCP
      targetPort: 8124
  selector:
    {{- include "axon-server.selectorLabels" . | nindent 4 }}
---
apiVersion: v1
kind: Service
metadata:
  name: {{ include "axon-server.fullname" . }}
  labels:
    {{- include "axon-server.labels" . | nindent 4 }}
spec:
  type: {{ .Values.services.gui.type }}
  ports:
    - name: http
      port: {{ .Values.services.gui.port }}
      protocol: TCP
      targetPort: 8024
  selector:
    {{- include "axon-server.selectorLabels" . | nindent 4 }}

{{- range $i, $e := until ($.Values.replicaCount | int) }}
---
apiVersion: v1
kind: Service
metadata:
  name: {{ include "axon-server.fullname" $ }}-{{ $i }}
  labels:
    {{- include "axon-server.labels" $ | nindent 4 }}
spec:
  type: {{ $.Values.services.grpc.type }}
  ports:
    - name: grpc-port-internal
      port: {{ $.Values.services.internalGrpc.port }}
      protocol: TCP
      targetPort: 8224
  selector:
    statefulset.kubernetes.io/pod-name: {{ include "axon-server.fullname" $ }}-{{ $i }}
{{- end }}
